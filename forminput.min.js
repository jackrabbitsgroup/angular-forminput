"use strict";angular.module("jackrabbitsgroup.angular-forminput",[]).directive("jrgForminput",["$timeout",function($timeout){return{restrict:"A",scope:{ngModel:"=",opts:"=?",selectOpts:"=",optsDatetime:"=?",validateDatetime:"&?",onchangeDatetime:"&?",ngClick:"&?"},require:"?^form",template:function(element,attrs){attrs.type||(attrs.type="text");var defaults={noLabel:0};for(var xx in defaults)void 0===attrs[xx]&&(attrs[xx]=defaults[xx]);for(var attrsToInt=["noLabel"],ii=0;ii<attrsToInt.length;ii++)attrs[attrsToInt[ii]]=parseInt(attrs[attrsToInt[ii]],10);var placeholder=(attrs.class||"",attrs.placeholder||attrs.label||""),label=attrs.label||attrs.placeholder||"",html={label:"",input:"",validation:""};label&&!attrs.noLabel&&(html.label="<label>"+label+"</label>");var customAttrs="",skipAttrs=["jrgForminput","ngModel","label","type","placeholder","opts","name","optsDatetime","validateDatetime","onchangeDatetime","checkboxVals","ngClick"];angular.forEach(attrs,function(value,key){"$"!==key.charAt(0)&&-1===skipAttrs.indexOf(key)&&(customAttrs+=attrs.$attr[key],attrs[key]&&(customAttrs+="="+attrs[key]),customAttrs+=" ")});var uniqueName="jrgFormInput"+attrs.type+Math.random().toString(36).substring(7),elementTag="input";"text"==attrs.type||"email"==attrs.type||"tel"==attrs.type||"number"==attrs.type||"url"==attrs.type?(html.input="<input class='jrg-forminput-input' name='"+uniqueName+"' ng-model='ngModel' ng-change='onchange({})' type='"+attrs.type+"' placeholder='"+placeholder+"' "+customAttrs+" ",attrs.ngClick&&(html.input+="ng-click='ngClick()' "),html.input+="/>"):"password"==attrs.type?(html.input="<input class='jrg-forminput-input' name='"+uniqueName+"' ng-model='ngModel' ng-change='onchange({})' type='password' placeholder='"+placeholder+"' "+customAttrs+" ",attrs.ngClick&&(html.input+="ng-click='ngClick()' "),html.input+="/>"):"textarea"==attrs.type?(elementTag="textarea",html.input="<textarea class='jrg-forminput-input' name='"+uniqueName+"' ng-model='ngModel' ng-change='onchange({})'  placeholder='"+placeholder+"' "+customAttrs+" ",attrs.ngClick&&(html.input+="ng-click='ngClick()' "),html.input+="></textarea>"):"checkbox"==attrs.type?(html.input="<div class='jrg-forminput-input jrg-forminput-input-checkbox-cont'><input class='jrg-forminput-input-checkbox' name='"+uniqueName+"' ng-model='ngModel' ng-change='onchange({})' type='checkbox' placeholder='"+placeholder+"' "+customAttrs+" ",attrs.ngClick&&(html.input+="ng-click='ngClick()' "),html.input+="/></div>"):"select"==attrs.type?(elementTag="select",html.input="<select class='jrg-forminput-input' name='"+uniqueName+"' ng-model='ngModel' ng-change='onchange({})' "+customAttrs+" ng-options='opt.val as opt.name for opt in selectOpts' ",attrs.ngClick&&(html.input+="ng-click='ngClick()' "),html.input+="></select>"):"multi-select"==attrs.type?(elementTag="div",html.input="<div class='jrg-forminput-input'><div name='"+uniqueName+"' jrg-multiselect select-opts='selectOpts' ng-model='ngModel' config='opts' ",attrs.ngClick&&(html.input+="ng-click='ngClick()' "),attrs.onChangeEvt=uniqueName+"MultiSelectOnChange",html.input+="on-change-evt='"+attrs.onChangeEvt+"' ",html.input+="></div></div>"):("date"==attrs.type||"datetime"==attrs.type)&&(elementTag="div",html.input="<div class='jrg-forminput-input' name='"+uniqueName+"' jrg-datetimepicker opts='optsDatetime' ng-model='ngModel'  placeholder='"+placeholder+"' "+customAttrs,attrs.validateDatetime&&(html.input+="validate='validateDatetime' "),attrs.onchangeDatetime&&(html.input+="onchange='onchangeDatetime' "),attrs.ngClick&&(html.input+="ng-click='ngClick()' "),html.input+=">",html.input+="</div>"),html.validation="<div class='jrg-forminput-validation text-error' ng-repeat='(key, error) in field.$error track by $id($index)' ng-show='error && field.$dirty' class='help-inline'>{{opts1.validationMessages[key]}} <span ng-show='!opts1.validationMessages[key]'>Invalid</span></div>";var htmlFull="<div class='jrg-forminput-cont'><div class='jrg-forminput'>"+html.label+html.input+"</div>"+html.validation+"</div>";return attrs.elementTag=elementTag,attrs.uniqueName=uniqueName,htmlFull},link:function(scope,element,attrs,formCtrl){void 0===attrs.id&&(attrs.id="jrgFormInput"+attrs.type+Math.random().toString(36).substring(7)),attrs.name||(attrs.name=attrs.id),scope.id=attrs.id,scope.name=attrs.name,element.find(attrs.elementTag+".jrg-forminput-input").attr("name",attrs.name),"checkbox"==attrs.type&&void 0!==scope.ngModel&&(scope.ngModel=scope.ngModel.toString()),formCtrl&&(formCtrl[attrs.name]=formCtrl[attrs.uniqueName],delete formCtrl[attrs.uniqueName],scope.field=formCtrl[attrs.name],scope.$watch("ngModel",function(newVal,oldVal){if(!angular.equals(oldVal,newVal)){var xx,valid=!0;for(xx in formCtrl)if(void 0!==formCtrl[xx].$valid&&formCtrl[xx].$valid!==!0){valid=!1;break}formCtrl.$valid=valid,formCtrl.$invalid=!valid}}))},controller:function($scope,$element,$attrs){function init(){("select"==$attrs.type||"multiSelect"==$attrs.type)&&initSelect({})}function initSelect(){initSelectModel({}),initSelectOpts({})}function initSelectModel(){void 0!==$scope.ngModel&&"string"!=typeof $scope.ngModel&&($scope.ngModel=$scope.ngModel.toString())}function initSelectOpts(){var ii;for(ii=0;ii<$scope.selectOpts.length;ii++)if("number"==typeof $scope.selectOpts[ii].val)$scope.selectOpts[ii].val=$scope.selectOpts[ii].val.toString();else;}$scope.opts1={};var defaultOpts={validationMessages:{required:"Required!",minlength:"Too short!",maxlength:"Too long!",pattern:"Invalid characters!",email:"Invalid email",number:"Must be a number!"}};if($scope.opts&&void 0!==$scope.opts){var xx;for(xx in defaultOpts)$scope.opts1[xx]=$scope.opts[xx]&&void 0!==$scope.opts[xx]?angular.extend(defaultOpts[xx],$scope.opts[xx]):defaultOpts[xx]}else $scope.opts1=defaultOpts;$scope.opts&&$scope.opts.ngChange&&($scope.onchange=function(){$timeout(function(){$scope.opts.ngChange()},50)},$attrs.onChangeEvt&&$scope.$on($attrs.onChangeEvt,function(){$scope.opts.ngChange()})),("date"==$attrs.type||"datetime"==$attrs.type)&&(void 0!==$scope.optsDatetime&&$scope.optsDatetime||($scope.optsDatetime={pikaday:{}}),"datetime"==$attrs.type&&($scope.optsDatetime.pikaday.showTime=!0)),$scope.$watch("ngModel",function(newVal,oldVal){angular.equals(oldVal,newVal)||("select"==$attrs.type||"multiSelect"==$attrs.type)&&initSelectModel({})}),init({})}}}]);